\documentclass[letter,10pt]{article}

\usepackage{tikz,pgflibraryshapes}
\usetikzlibrary{arrows, calc, decorations.pathmorphing}
\usepackage[psfixbb,graphics,tightpage,active]{preview}

\PreviewEnvironment{tikzpicture}
\newlength{\imagewidth}
\newlength{\imagescale}

\usepackage{xcolor}
\usepackage{color}
\usepackage{amsmath}


\definecolor{orange}{RGB}{255,127,0}
\definecolor{gris}{RGB}{230,230,230}

\usetikzlibrary{shapes,arrows}
\pgfdeclarelayer{background}
\pgfdeclarelayer{foreground}
\pgfsetlayers{background,main,foreground}
\tikzstyle{startstop} = [rectangle, rounded corners, minimum width=3cm, minimum height=1.5cm,text centered, draw=black, fill=white!30,double]

\tikzstyle{circulo} = [circle, rounded corners, minimum width=1cm, minimum height=1cm,text centered, draw=black, fill=white!30,sloped]

\tikzstyle{pattern} = [rectangle, rounded corners, minimum height=0.6cm,text centered, draw=black, fill=white!30,text width=2cm]

\tikzstyle{pat} = [rectangle, rounded corners, minimum height=0.6cm,text centered, draw=black, fill=white!30,text width=2cm,double]

\tikzstyle{objseg} = [rectangle, rounded corners, minimum height=0.6cm,text centered, draw=black, fill=white!30,text width=2.5cm]

\tikzstyle{amenazas} = [rectangle, rounded corners, minimum height=0.6cm,text centered, draw=black, fill=white!30,text width=2cm]



\tikzstyle{arrow} = [thick,->,>=stealth]
\tikzstyle{arrow1} = [thick,<-,>=stealth]

\begin{document}

\begin{tikzpicture}[node distance=1.5cm]
	
	
	\node (req1) [circulo,xshift=3cm,yshift=2cm] {$Req_1$};
	\node (susp) [draw=none,fill=none,xshift=4.1cm,yshift=2cm] {\textbf{\dots}};
	\node (req2) [circulo,xshift=5cm,yshift=2cm] {$Req_k$};
	\node (req3) [circulo,xshift=10.1cm,yshift=2cm] {\scriptsize$Req_{k+1}$};
	\node (susp) [draw=none,fill=none,xshift=11.2cm,yshift=2cm] {\textbf{\dots}};
	\node (req4) [circulo,xshift=12.1cm,yshift=2cm] {$Req_{j}$};
	\node (susp) [draw=none,fill=none,xshift=18.3cm,yshift=2cm] {\textbf{\dots}};
	\node (req5) [circulo,xshift=17.1cm,yshift=2cm] {\scriptsize$Req_{j+1}$};
	\node (reqn) [circulo,xshift=19.2cm,yshift=2cm] {$Req_N$};
		
	\node (Int) [objseg,xshift=4.1cm] {Integridad};
	\node (Conf) [objseg,xshift=11.2cm] {Confidencialidad};
	\node (Dis) [objseg,xshift=18.3cm] {Disponibilidad};
	
	
	
	\node (w1) [draw=none,fill=none,xshift=4.1cm,yshift=-2cm] {$w_I$};
	\node (w2) [draw=none,fill=none,xshift=11.2cm,yshift=-2cm] {$w_C$};
	\node (w3) [draw=none,fill=none,xshift=18.3cm,yshift=-2cm] {$w_D$};
	
	\draw [thick] (Int) -- (w1);
	\draw [thick] (Conf) -- (w2);
	\draw [thick] (Dis) -- (w3);
		
	\draw [arrow] (req1) -- (Int);
	\draw [arrow] (req2) -- (Int);
	\draw [arrow] (req3) -- (Conf);
	\draw [arrow] (req4) -- (Conf);
	\draw [arrow] (req5) -- (Dis);
	\draw [arrow] (reqn) -- (Dis);
	
	\node (ame1) [amenazas,yshift=-4cm,xshift=1.3cm] {Suplantaci\'on};
	\node (pa1) [yshift=-3.2cm,xshift=1.9cm] {\tiny P(S)};
	\node (ame2) [amenazas,yshift=-4cm,xshift=4.1cm] {Repudio};
	\node (pa2) [yshift=-3.2cm,xshift=3.8cm] {\tiny P(R)};
	\node (ame3) [amenazas,yshift=-4cm, xshift=6.8cm] {Informaci\'on expuesta};
	\node (pa3) [yshift=-3.2cm,xshift=6.3cm] {\tiny P(I)};
	
	\node (ame4) [amenazas,yshift=-4cm,xshift=10.2cm] {Modificaci\'on};
	\node (pa4) [yshift=-3.2cm,xshift=10.1cm] {\tiny P(M)};
	\node (ame5) [amenazas,yshift=-4cm,xshift=14.2cm] {Elevaci\'on de privilegios};
	\node (pa5) [yshift=-3.2cm,xshift=13.5cm] {\tiny P(E)};
	\node (ame6) [amenazas,yshift=-4cm,xshift=18.3cm] {Denegaci\'on de servicios};
	\node (pa6) [yshift=-3.2cm,xshift=18cm] {\tiny P(D)};
	
	\draw [arrow1] (w1) -- (ame1);
	\draw [arrow1] (w1) -- (ame2);
	\draw [arrow1] (w1) -- (ame3);
	\draw [arrow1] (w2) -- (ame4);
	\draw [arrow1] (w2) -- (ame5);
	\draw [arrow1] (w3) -- (ame6);
	
	\node (att1) [pattern,yshift=-6cm] {Phishing};
	\node () [yshift=-5.5cm,xshift=-0.6cm] {\tiny $P(At_1)\cdot v_p$};
	\node (att2) [pattern,yshift=-7.5cm,xshift=1.3cm] {Identity theft};
	\node () [yshift=-6.9cm,xshift=2.2cm] {\tiny $P(At_2)\cdot v_p$};
	\node (att3) [pattern,yshift=-6cm,xshift=2.6cm] {Botnets};
	\node () [yshift=-5.5cm,xshift=3.2cm] {\tiny $P(At_3)\cdot v_p$};
	
	\draw [arrow] (ame1) -- (att1);
	\draw [arrow] (ame1) -- (att2);
	\draw [arrow] (ame1) -- (att3);
	
	\node (att4) [pattern,yshift=-6cm,xshift=5.5cm] {Web application attacks};
	\node (att5) [pattern,yshift=-7.5cm,xshift=6.8cm] {Information leakage};
	
	\draw [arrow] (ame3) -- (att4);
	\draw [arrow] (ame3) -- (att5);
	
	\node (att6) [pattern,yshift=-6cm,xshift=10.2cm] {Data breaches};
	
	\draw [arrow] (ame4) -- (att6);
	
	\node (att7) [pattern,yshift=-6cm,xshift=13cm] {Exploit kits};
	\node (att8) [pattern,yshift=-7.5cm,xshift=14.3cm] {Web based attacks};
	
	\draw [arrow] (ame5) -- (att7);
	\draw [arrow] (ame5) -- (att8);
	
	\node (att9) [pattern,yshift=-6cm,xshift=17cm] {DDoS};
	\node (att10) [pattern,yshift=-6cm,xshift=20cm] {Ransomware};
	
	\draw [arrow] (ame6) -- (att9);
	\draw [arrow] (ame6) -- (att10);
	
	\node (pat1) [pat,yshift=-9cm] {$Pat_1$};
	\node (pat1p) [pat,yshift=-10cm] {$Pat_1'$};
	\node () [yshift=-8.5cm,xshift=-0.5cm] {\tiny $v_p=0$};
	\node (patv) [pat,yshift=-9.5cm,xshift=5.7cm] {$Pat_i$};
	\node (pat2) [pat,yshift=-9cm,xshift=5.5cm] {$Pat_2$};
	\node (pat3) [pat,yshift=-9cm,xshift=10.2cm] {$Pat_{i+1}$};
	\node (susp1) [draw=none,fill=none,yshift=-9cm,xshift=13cm] {\textbf{\dots}};
	\node (patn) [pat,yshift=-9cm,xshift=17cm] {$Pat_P$};
	
	\draw [dotted,thick] (pat1) -- (att1);
	\draw [dotted,thick] (pat2) -- (att4);
	\draw [dotted,thick] (pat3) -- (att6);
	\draw [dotted,thick] (patn) -- (att9);
	
\node (vacio1)  [draw=none,fill=none,yshift=-3.7cm,xshift=-0.7cm]{};
\node (vacio2)  [draw=none,fill=none,yshift=-7.5cm,xshift=20.7cm]{};
	\begin{pgfonlayer}{background}
		\path (ame1.west |- ame1.north)+(-0.5,0.3) node (a) {};
		\path (ame6.east |- ame6.south)+(+0.5,-0.5) node (c) {};
            	\path[fill=gris!20,rounded corners, draw=black,double] (a) rectangle (c);  
    	\end{pgfonlayer}

\end{tikzpicture}



\end{document}